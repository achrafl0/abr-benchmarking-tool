<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Tests network</title>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="data.js""></script>
    <div>
      <canvas id="myChart"></canvas>
    </div>
    <script charset="utf-8">
      console.log(dataset)
      const formatTime = (data) => {
        return data.map(({x, y}) => {
          return {
            y,
            x: new Date(x).toISOString()
          }
        })
      }
      const audioSet = {
        label: 'Audio Bitrate',
        yAxisID: 'audioYAxis',
        borderColor: '#ffbaa2',
        backgroundColor: 'white',
        data: formatTime(dataset.audioBitrate), 
        stepped: 'after',
        fill: false
      }
      const videoSet = {
        label: 'Video Bitrate',
        borderColor: '#91cf96',
        backgroundColor: 'white',
        data: formatTime(dataset.videoBitrate), 
        stepped: 'before',
        fill: false,
        yAxisID: 'videoYAxis'
      }
      const bandwidthSet = {
        label: 'Bandwidth (kb/s)',
        borderColor: '#c881d2',
        backgroundColor: 'white',
        data: formatTime(dataset.bandwidth), 
        stepped: 'after',
        fill: false,
        yAxisID: 'bandwidthYAxis'
      }
      const latencySet = {
        label: 'Latency (ms)',
        borderColor: '#29b6f6',
        backgroundColor: 'white',
        data: formatTime(dataset.latency),
        stepped: 'after',
        fill: false,
        yAxisID: 'latencyYAxis'
      }

      const config = {
        type: 'line',
        data: { datasets: [videoSet, audioSet, bandwidthSet, latencySet] },
        options: {
          scales: {
            audioYAxis: {
              title: {text: 'Audio bitrate', display: true},
              type: 'linear',
              position: 'left',
              min: -1,
              max: 1000,
              ticks: {
                color: '#ffbaa2',
                callback: function(value, index, values) {
                  return value + ' kbit/s';
                }
              }
            },
            videoYAxis: {
              title: {text: 'Video bitrate', display: true},
              type: 'linear',
              position: 'left',
              min: -1,
              max: 4500000,
              ticks: {
                color: '#91cf96',
                callback: function(value, index, values) {
                  return value + ' kbit/s';
                },
              }
            },
            bandwidthYAxis: {
              title: {text: 'Bandwidth ', display: true},
              type: 'linear',
              position: 'right',
              min: 500,
              max: 25000,
              ticks: {
                color: '#c881d2',
                callback: function(value, index, values) {
                  return value + ' kbit/s';
                }
              }
            }, 
            latencyYAxis: {
              title: {
                display: true,
                text: 'Latency',
              },
              type: 'linear',
              position: 'right',
              min: 0,
              max: 1500,
              ticks: {
                color: (x) => '#29b6f6',
                callback: function(value, index, values) {
                  return value + ' ms';
                }
              },
              scaleLabel: {
                display: false
              },
            }
          },
          elements: {
            line: {
              tension: 0, // disables bezier curves
            },
            point: {
              radius: 4,
              borderWidth: 2,
              pointStyle: 'circle'
            }
          }
        }
      };
      var myChart = new Chart(document.getElementById("myChart"), config);
    </script>
  </body>
</html>
